<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nia Cruz üñ§ Latina Cutie - onyfans</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .image-item:not(.unlocked) img, .video-item:not(.unlocked) video {
            filter: blur(8px) brightness(0.8) contrast(0.7);
        }
        .image-item img, .video-item video {
            transition: filter 0.3s ease;
        }
        
        /* Corre√ß√£o para v√≠deos - evitar 100% de altura incorreta */
        .video-item video {
            max-width: 100%;
            max-height: 100%;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .aspect-video {
            aspect-ratio: 16 / 9;
            position: relative;
        }
        
        /* Fallback para navegadores sem suporte a aspect-ratio */
        @supports not (aspect-ratio: 16 / 9) {
            .aspect-video {
                padding-bottom: 56.25%; /* 16:9 ratio */
                height: 0;
            }
            .aspect-video video, .aspect-video img {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
            }
        }
        
        /* Estilos espec√≠ficos para mobile */
        @media (max-width: 768px) {
            .profile-overlay {
                padding: 0.5rem !important;
                max-width: 180px !important;
            }
            
            .profile-overlay h4 {
                font-size: 0.75rem !important;
                line-height: 1rem !important;
            }
            
            .profile-overlay p {
                font-size: 0.65rem !important;
            }
        }
    </style>
</head>
<body class="bg-white text-gray-900 overflow-hidden h-screen">
    <div class="bg-white p-3 text-center text-sm border-b border-gray-300 relative">
        <span class="text-gray-900">üíï Seja bem-vindo meus amores ao onyfans mundo! Meu Pack Amor s√≥ hoje 50%</span>
        <button class="ml-2 bg-blue-500 hover:bg-blue-600 px-4 py-1 rounded text-white">‚ù§Ô∏è VOLTAR AO APLICATIVO</button>
        
        <!-- Bot√£o de verifica√ß√£o manual de pagamento -->
        <button onclick="openManualPaymentCheck()" class="absolute right-3 top-1/2 transform -translate-y-1/2 bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs font-medium transition-colors">
            üí∞ J√° Paguei
        </button>
    </div>

    <div class="flex h-screen">
        <div class="w-64 bg-white border-r border-gray-200 p-4 flex-shrink-0 overflow-y-auto hidden md:block">
            <div class="flex items-center mb-8">
                <h2 class="text-lg font-bold text-gray-900">onyfans</h2>
            </div>
            <nav class="space-y-2">
                <a href="#" 
                   class="flex items-center space-x-3 p-2 rounded-lg transition-colors text-gray-700 hover:bg-gray-100"
                   >
                    <i class="fas fa-home w-5 "></i>
                    <span>In√≠cio</span>
                    
                </a>
                <a href="#" class="flex items-center space-x-3 text-gray-700 p-2 rounded-lg hover:bg-gray-100" onclick="event.preventDefault(); openModelosModal(); return false;">
                    <i class="fas fa-search w-5"></i><span>Descobrir</span>
                </a>
            </nav>
        </div>

        <div class="flex-1 p-4 md:p-6 overflow-y-auto scrollbar-hide relative" style="">
            
            <div class="relative z-10">
                
                <div class="mb-6 flex justify-center relative">
                    <div class="w-full rounded-lg overflow-hidden shadow-lg border-4 border-white bg-gray-100 relative" style="width: 960px; height: 300px; max-width: 100%;">
                        <img src="https://images.unsplash.com/photo-1494790108755-2616c345834c?w=800&h=400&fit=crop" alt="Imagem de Destaque" class="w-full h-full object-cover">
                        
                        <!-- Nome e Avatar destacados no canto esquerdo -->
                        <div class="absolute top-4 left-4 flex items-center space-x-3 z-20">
                            <!-- Avatar -->
                            
                            <div class="w-12 h-12 md:w-16 md:h-16 rounded-full overflow-hidden border-3 border-white shadow-lg bg-white">
                                <img src="https://images.unsplash.com/photo-1494790108755-2616c345834c?w=300&h=300&fit=crop&crop=face" alt="Avatar" class="w-full h-full object-cover">
                            </div>
                            
                            
                            <!-- Nome da Modelo -->
                            <div class="bg-black/70 backdrop-blur-sm text-white px-2 py-1.5 rounded-lg shadow-lg">
                                <h2 class="text-sm md:text-base font-bold leading-tight">Nia Cruz üñ§ Latina Cutie</h2>
                                <p class="text-xs opacity-90">@niacruzxo</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                
                <div class="absolute top-4 right-4 flex items-center space-x-4 z-10">
                    <!-- Bot√£o de busca para mobile -->
                    <button onclick="openModelosModal()" class="md:hidden bg-black bg-opacity-50 hover:bg-opacity-70 text-white p-2 rounded-full backdrop-blur-sm transition-all duration-300" title="Descobrir modelos">
                        <i class="fas fa-search w-4 h-4"></i>
                    </button>
                    
                    <div class="flex items-center space-x-3">
                        <div class="flex items-center space-x-1 text-white">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                            <span class="text-sm font-medium">809</span>
                        </div>
                        <div class="flex items-center space-x-1 text-white">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span class="text-sm font-medium">740</span>
                        </div>
                    </div>
                </div>
                
                 

                <div class="bg-gray-50 border border-gray-200 rounded-lg p-3 md:p-4 mb-4">
                    <div class="flex items-center mb-3">
                        <div class="w-8 h-8 rounded-full overflow-hidden mr-3 flex-shrink-0">
                            <img src="https://images.unsplash.com/photo-1494790108755-2616c345834c?w=300&h=300&fit=crop&crop=face" alt="Profile" class="w-full h-full object-cover">
                        </div>
                        <span class="text-sm text-gray-700">N√£o vou deixar essa oferta para sempre, ent√£o √© melhor voc√™ se apressar e entrar aqui üòè</span>
                    </div>
                      <button id="subscribeBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 md:py-3 px-4 md:px-6 rounded-lg transition-colors text-sm md:text-base">
                          COMPRAR MEU PACK R$ 1,00
                      </button>
                     
                </div>

                <div class="flex justify-center mb-6">
                    <div class="flex rounded-lg overflow-hidden w-full max-w-sm">
                         <button id="imagesTabBtn" onclick="showImagesTab()" class="flex-1 px-8 py-3 text-center cursor-pointer transition-colors bg-blue-500 text-white">
                             <div class="text-lg font-bold">2</div>
                             <div class="text-xs font-medium tracking-wide">IMAGENS</div>
                         </button>
                         <button id="videosTabBtn" onclick="showVideosTab()" class="flex-1 px-8 py-3 text-center cursor-pointer transition-colors bg-gray-600 text-white">
                             <div class="text-lg font-bold">1</div>
                             <div class="text-xs font-medium tracking-wide">V√çDEOS</div>
                         </button>
                    </div>
                </div>

                <div id="imagesGrid" class="grid grid-cols-1 gap-4 mb-6">
                    <!-- Conte√∫do ser√° carregado via JavaScript com pagina√ß√£o -->
                </div>
                
                <!-- Pagina√ß√£o de Imagens -->
                <div id="imagesPagination" class="flex justify-center items-center gap-2 mb-6">
                    <!-- Pagina√ß√£o ser√° carregada via JavaScript -->
                </div>

                <div id="videosGrid" class="grid grid-cols-1 gap-4 mb-6 hidden">
                    <!-- Conte√∫do ser√° carregado via JavaScript com pagina√ß√£o -->
                </div>
                
                <!-- Pagina√ß√£o de V√≠deos -->
                <div id="videosPagination" class="flex justify-center items-center gap-2 mb-6 hidden">
                    <!-- Pagina√ß√£o ser√° carregada via JavaScript -->
                </div>
            </div>
        </div>

        <!-- Avatar Flutuante Simplificado -->
        <div class="fixed bottom-4 right-4 z-50 cursor-pointer group" onclick="openChatExternal()">
            <!-- Container do Avatar -->
            <div class="relative bg-white rounded-full p-2 shadow-xl border-2 border-blue-500 hover:scale-110 transition-all duration-300">
                <!-- Avatar -->
                <div class="w-12 h-12 rounded-full overflow-hidden">
                    <img src="https://images.unsplash.com/photo-1494790108755-2616c345834c?w=300&h=300&fit=crop&crop=face" alt="Nia Cruz üñ§ Latina Cutie" class="w-full h-full object-cover">
                </div>
                
                <!-- Status Online/Offline -->
                <div class="absolute -top-1 -right-1">
                    <div id="statusIndicator" class="w-4 h-4 rounded-full border-2 border-white bg-green-500"></div>
                </div>
            </div>
            
            <!-- Texto abaixo do avatar -->
            <div class="absolute -bottom-8 left-1/2 transform -translate-x-1/2 whitespace-nowrap">
                <p class="text-xs font-bold text-blue-600 bg-white px-2 py-1 rounded shadow-md">Fale comigo amor</p>
            </div>
        </div>

        <div class="w-80 bg-white border-l border-gray-200 p-4 flex-shrink-0 overflow-y-auto hidden lg:block">
            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <h3 class="font-semibold mb-4 text-gray-900">ASSINATURA</h3>
                
                <div class="flex items-center justify-center mb-4 p-4 bg-white rounded-lg border shadow-sm">
                    <button id="likeBtn" class="flex items-center space-x-3 text-gray-600 hover:text-red-500 transition-all duration-300 transform hover:scale-105">
                        <div class="relative">
                            <i id="likeIcon" class="far fa-heart text-4xl transition-all duration-300"></i>
                            <div id="likeAnimation" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 items-center justify-center animate-bounce hidden">
                                +
                            </div>
                        </div>
                        <div class="text-center">
                            <div id="likeCount" class="text-3xl font-bold text-gray-800">100</div>
                            <div class="text-sm text-gray-500 font-medium">CURTIDAS</div>
                        </div>
                    </button>
                </div>
                
                <div class="mb-4">
                    <div class="text-lg font-bold text-gray-900 mb-2">Oferta limitada: 50% de desconto nos primeiros 31 dias!</div>
                    <div class="text-sm text-gray-600 mb-2">Oferta termina ago 23 ‚Ä¢ 9 ofertas √† esquerda</div>
                </div>
                
                <button id="sidebarSubscribeBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors mb-2">
                    <div class="text-center">COMPRAR MEU PACK R$ 1,00</div>
                </button>
                <div class="text-center text-sm text-gray-500 mb-4">
                    Pre√ßo Normal R$5,00
                </div>
            </div>
        </div>
    </div>

    <div id="subscriptionModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden p-4 overflow-y-auto">
        <div class="bg-white border border-gray-300 rounded-lg p-4 md:p-6 w-full max-w-md mx-auto my-8 relative min-h-fit max-h-[90vh] overflow-y-auto"
             style="max-width: min(90vw, 28rem); width: 100%;"
        >
            <button id="closeModal" class="absolute top-2 right-2 md:top-3 md:right-3 text-gray-400 hover:text-gray-600 w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors">
                <i class="fas fa-times text-sm md:text-lg"></i>
            </button>
            
            <div class="text-center mb-4 md:mb-6">
                <div class="flex flex-col sm:flex-row items-center justify-center mb-3 md:mb-4">
                    <h2 class="text-lg md:text-xl font-bold text-gray-900 text-center break-words">Nia Cruz üñ§ Latina Cutie</h2>
                    <span class="ml-0 sm:ml-2 mt-1 sm:mt-0 text-green-500">‚úÖ</span>
                </div>
                <p class="text-gray-600 text-sm break-words">@niacruzxo</p>
            </div>

            <div class="mb-4 md:mb-6">
                <h3 class="font-semibold mb-2 md:mb-3 text-gray-900 text-sm md:text-base">SUBSCREVA E OBTENHA ESTES BENEF√çCIOS:</h3>
                <div class="space-y-2 text-xs md:text-sm">
                    <div class="flex items-start">
                        <span class="text-green-500 mr-2 mt-0.5 flex-shrink-0">‚úì</span>
                        <span class="text-gray-800 break-words">Acesso total ao conte√∫do deste usu√°rio</span>
                    </div>
                    <div class="flex items-start">
                        <span class="text-green-500 mr-2 mt-0.5 flex-shrink-0">‚úì</span>
                        <span class="text-gray-800 break-words">Crie seu cadastro primeiro com seu whatsapp e por ele que sera liberado ap√≥s voc√™ criar clique no bot√£o meu pack para efetuar sua compra</span>
                    </div>
                </div>
            </div>

            <!-- Tabs Navigation -->
            <div class="mb-4 md:mb-6">
                <div class="border-t border-gray-200 pt-3 md:pt-4">
                    <div class="flex mb-2 md:mb-3 border-b border-gray-200">
                        <button id="loginTab" onclick="showLoginTab()" class="flex-1 text-center py-2 px-2 md:px-4 text-xs md:text-sm font-medium text-gray-500 border-b-2 border-transparent hover:text-blue-600">
                            Entrar
                        </button>
                        <button id="registerTab" onclick="showRegisterTab()" class="flex-1 text-center py-2 px-2 md:px-4 text-xs md:text-sm font-medium text-blue-600 border-b-2 border-blue-600">
                            Cadastro
                        </button>
                    </div>
                    
                    <!-- Login Tab Content -->
                    <div id="loginTabContent" class="space-y-2 md:space-y-3 hidden">
                        <div class="relative">
                            <span class="absolute left-2 md:left-3 top-1/2 transform -translate-y-1/2 text-xs md:text-sm text-gray-600">+55</span>
                            <input type="tel" id="loginEmail" placeholder="11982969676" class="w-full pl-10 md:pl-12 pr-2 md:pr-3 py-2 border border-gray-300 rounded-md text-xs md:text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" maxlength="11">
                        </div>
                        <p class="text-xs text-gray-500 text-center">Digite o WhatsApp cadastrado ap√≥s efetuar o pagamento</p>
                        
                        <!-- Apenas bot√£o ENTRAR na aba Entrar -->
                        <div class="space-y-2 md:space-y-3 mt-4">
                            <button onclick="handleAccess()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 md:py-3 px-3 md:px-4 rounded text-sm md:text-base transition-colors">
                                üöÄ ENTRAR
                            </button>
                        </div>
                    </div>
                    
                    <!-- Register Tab Content -->
                    <div id="registerTabContent" class="space-y-2 md:space-y-3">
                        <!-- Avatar e Nome da Modelo -->
                        <div class="flex items-center space-x-3 mb-4 p-3 bg-gray-50 rounded-lg">
                            <div class="w-12 h-12 rounded-full overflow-hidden border-2 border-blue-200 flex-shrink-0">
                                <img src="https://images.unsplash.com/photo-1494790108755-2616c345834c?w=300&h=300&fit=crop&crop=face" alt="Nia Cruz üñ§ Latina Cutie" class="w-full h-full object-cover">
                            </div>
                            <div class="flex-1">
                                <h4 class="text-sm font-bold text-gray-900">Nia Cruz üñ§ Latina Cutie</h4>
                                <p class="text-xs text-gray-600">@niacruzxo</p>
                            </div>
                        </div>
                        
                        <!-- Benef√≠cios do Cadastro -->
                        <div class="space-y-2 text-xs md:text-sm mb-4">
                            <div class="flex items-start">
                                <span class="text-green-500 mr-2 mt-0.5 flex-shrink-0">‚úì</span>
                                <span class="text-gray-800 break-words">Acesso total ao conte√∫do deste usu√°rio</span>
                            </div>
                            <div class="flex items-start">
                                <span class="text-green-500 mr-2 mt-0.5 flex-shrink-0">‚úì</span>
                                <span class="text-gray-800 break-words font-semibold">Crie seu cadastro primeiro com seu whatsapp e por ele que sera liberado ap√≥s voc√™ criar clique no bot√£o meu pack para efetuar sua compra</span>
                            </div>
                        </div>
                        
                        <div class="relative">
                            <span class="absolute left-2 md:left-3 top-1/2 transform -translate-y-1/2 text-xs md:text-sm text-gray-600">+55</span>
                            <input type="tel" id="registerWhatsapp" placeholder="11982969676" class="w-full pl-10 md:pl-12 pr-2 md:pr-3 py-2 border border-gray-300 rounded-md text-xs md:text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" maxlength="11">
                        </div>
                        
                        <!-- Bot√£o Enviar Cadastro -->
                        <button onclick="handleWhatsAppRegister()" class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-2 md:py-3 px-3 md:px-4 rounded text-sm md:text-base transition-colors">
                            üì± ENVIAR CADASTRO
                        </button>
                        
                        <!-- Bot√£o COMPRAR (inicialmente oculto) -->
                        <div id="buyButtonContainer" class="hidden mt-3">
                            <button id="modalPurchaseBtn" onclick="handlePurchase()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 md:py-3 px-3 md:px-4 rounded text-sm md:text-base transition-colors animate-pulse">
                                üí≥ COMPRAR - R$ 1,00
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            
            <p class="text-xs text-gray-600 mb-3 md:mb-4 text-center leading-relaxed">Ao fazer login e usar o onyfans, voc√™ concorda com nossos Termos de Servi√ßo e Pol√≠tica de Privacidade e confirma que tem pelo menos 18 anos de idade.</p>
        </div>
    </div>

    <!-- Modal das Modelos -->
    <div id="modelosModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden p-4 overflow-y-auto">
        <div class="bg-white rounded-lg p-6 w-full max-w-4xl mx-auto my-8 relative max-h-[90vh] overflow-y-auto">
            <button onclick="closeModelosModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors">
                <i class="fas fa-times text-lg"></i>
            </button>
            
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-900 mb-2">Descobrir Modelos</h2>
                <p class="text-gray-600">Explore todas as modelos dispon√≠veis no aplicativo</p>
                <p class="text-sm text-purple-600 mt-2 font-medium">üí° Para visualizar todas as modelos basta digitar o alfabeto ex: a, b, c, d, etc... assim por diante</p>
                
                <!-- Campo de busca -->
                <div class="mt-4 relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fas fa-search h-5 w-5 text-gray-400"></i>
                    </div>
                    <input
                        type="text"
                        id="modelosSearchInput"
                        placeholder="Buscar modelos por nome ou username..."
                        class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-purple-500 focus:border-purple-500 sm:text-sm"
                        oninput="searchModelos(this.value)"
                    />
                </div>
            </div>
            
            <!-- Loading -->
            <div id="modelosLoading" class="text-center py-8" style="display: none;">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"></div>
                <p class="mt-2 text-gray-600">Carregando modelos...</p>
            </div>
            
            <!-- Container das Modelos -->
            <div id="modelosContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- As modelos ser√£o carregadas aqui via JavaScript -->
            </div>
        </div>
    </div>

    <script>
        
        let isLoggedIn = false;
        let isLiked = false;
        let currentLikeCount = 100;
        
        // Vari√°veis de pagina√ß√£o
        let currentImagePage = 1;
        let currentVideoPage = 1;
        const itemsPerPage = 10;
        
        // Estado de pagamento confirmado
        let paymentConfirmed = false;
        
        // Lista de WhatsApps conhecidos para verifica√ß√£o autom√°tica
        const knownWhatsApps = ['11987043567', '11987043566', '11987043555', '11982969611'];
        
        // ‚úÖ FUN√á√ÉO PARA VERIFICAR PAGAMENTO ESPEC√çFICO DESTA P√ÅGINA
        async function checkPageSpecificPayment() {
            const currentPageId = '6b02a09a-8e83-4ae8-8c20-4688586b80f8'; // ID espec√≠fico desta p√°gina
            const currentModelId = 'e2ec4484-2e99-4d71-b717-47f0782dbc50'; // ID do modelo espec√≠fico desta p√°gina
            console.log('üéØ Verificando pagamento espec√≠fico para p√°gina:', currentPageId, 'modelo:', currentModelId);
            
            try {
                // Buscar apenas pagamentos para esta p√°gina/modelo espec√≠fico
                const response = await fetch('https://uxbfahumhkguuddrmlfu.supabase.co/rest/v1/whatsapp_registrations?model_id=eq.' + currentModelId + '&page_id=eq.' + currentPageId + '&status=eq.paid&select=whatsapp,model_id,page_id', {
                    headers: {
                        'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4YmZhaHVtaGtndXVkZHJtbGZ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxNTI5OTIsImV4cCI6MjA3MDcyODk5Mn0.Pgw4338wWXyX-CUEayY4_kYJ7MS0L-oWiLLsAqOo9LI',
                        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4YmZhaHVtaGtndXVkZHJtbGZ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxNTI5OTIsImV4cCI6MjA3MDcyODk5Mn0.Pgw4338wWXyX-CUEayY4_kYJ7MS0L-oWiLLsAqOo9LI'
                    }
                });
                
                const payments = await response.json();
                console.log('üì± Pagamentos encontrados para esta p√°gina:', payments);
                
                // Se existe algum pagamento confirmado para esta p√°gina, verificar se est√° no localStorage
                if (Array.isArray(payments) && payments.length > 0) {
                    const authenticatedWhatsapp = localStorage.getItem('authenticated_whatsapp');
                    const paymentConfirmedStorage = localStorage.getItem('payment_confirmed');
                    
                    // Verificar se o WhatsApp autenticado pagou por ESTA p√°gina espec√≠fica
                    const userPaidForThisPage = payments.some(payment => 
                        payment.whatsapp === authenticatedWhatsapp || 
                        payment.whatsapp === '+55' + authenticatedWhatsapp?.replace(/D/g, '') ||
                        ('+55' + payment.whatsapp.replace(/D/g, '')) === authenticatedWhatsapp
                    );
                    
                    if (userPaidForThisPage && paymentConfirmedStorage === 'true') {
                        console.log('‚úÖ USU√ÅRIO PAGOU POR ESTA P√ÅGINA ESPEC√çFICA!');
                        
                        globalAuthState.isAuthenticated = true;
                        globalAuthState.user = { whatsapp: authenticatedWhatsapp };
                        isLoggedIn = true;
                        paymentConfirmed = true;
                        
                        unlockAllContent();
                        showAutoAccessMessage(authenticatedWhatsapp);
                        
                        return true;
                    }
                }
                
                console.log('‚ùå Nenhum pagamento confirmado para esta p√°gina espec√≠fica');
                return false;
                
            } catch (error) {
                console.error('Erro na verifica√ß√£o espec√≠fica da p√°gina:', error);
                return false;
            }
        }
        
        // Fun√ß√£o para verificar status de pagamento via Supabase
        async function checkPaymentStatus(whatsapp) {
            try {
                // Tentar diferentes formatos do WhatsApp
                const phoneFormats = [
                    whatsapp,
                    whatsapp.replace(/D/g, ''), // Apenas n√∫meros
                    '+55' + whatsapp.replace(/D/g, ''), // Com +55
                    '55' + whatsapp.replace(/D/g, '') // Com 55
                ];

                console.log('üîç Verificando pagamento para formatos:', phoneFormats);

                const response = await fetch('https://uxbfahumhkguuddrmlfu.supabase.co/functions/v1/check-payment-status', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4YmZhaHVtaGtndXVkZHJtbGZ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxNTI5OTIsImV4cCI6MjA3MDcyODk5Mn0.Pgw4338wWXyX-CUEayY4_kYJ7MS0L-oWiLLsAqOo9LI'
                    },
                    body: JSON.stringify({
                        whatsapp: whatsapp,
                        modelId: 'e2ec4484-2e99-4d71-b717-47f0782dbc50',
                        pageId: '6b02a09a-8e83-4ae8-8c20-4688586b80f8'
                    })
                });
                
                const result = await response.json();
                console.log('üì± Resultado da verifica√ß√£o:', result);
                if (result.canLogin === true && result.status === 'paid') {
                    return true;
                }

                // Se n√£o est√° pago, retorna false sem liberar acesso
                return false;
            } catch (error) {
                console.error('Erro ao verificar status de pagamento:', error);
                return false;
            }
        }

        // Fun√ß√£o para verifica√ß√£o autom√°tica ao carregar a p√°gina
        async function checkAutoPayment() {
            console.log('üöÄ Iniciando verifica√ß√£o autom√°tica de pagamento...');
            
            // Verificar se j√° est√° autenticado
            if (globalAuthState.isAuthenticated) {
                console.log('‚úÖ Usu√°rio j√° autenticado');
                return;
            }

            // VERIFICAR: Apenas pagamentos para ESTA p√°gina espec√≠fica
            const pageSpecificResult = await checkPageSpecificPayment();
            if (pageSpecificResult) {
                return; // Se confirmado, parar aqui
            }
            
            console.log('‚ùå Nenhum pagamento confirmado encontrado automaticamente');
            
            // Adicionar verifica√ß√£o peri√≥dica para novos pagamentos
            setTimeout(() => {
                if (!globalAuthState.isAuthenticated) {
                    console.log('üîÑ Re-verificando pagamentos ap√≥s 30 segundos...');
                    checkAutoPayment();
                }
            }, 30000); // Verificar novamente em 30 segundos
        }

        // Fun√ß√£o para mostrar mensagem de acesso autom√°tico
        function showAutoAccessMessage(whatsappNumber) {
            const notification = document.createElement('div');
            notification.innerHTML = `
                <div style="
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #10B981, #059669);
                    color: white;
                    padding: 20px;
                    border-radius: 15px;
                    box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
                    z-index: 9999;
                    max-width: 350px;
                    border: 2px solid rgba(255, 255, 255, 0.2);
                ">
                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                        <div style="
                            width: 40px;
                            height: 40px;
                            background: rgba(255, 255, 255, 0.2);
                            border-radius: 50%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            margin-right: 12px;
                            font-size: 20px;
                        ">üéâ</div>
                        <div>
                            <div style="font-size: 16px; font-weight: bold; margin-bottom: 2px;">
                                ACESSO LIBERADO!
                            </div>
                            <div style="font-size: 12px; opacity: 0.9;">
                                WhatsApp: ${whatsappNumber}
                            </div>
                        </div>
                    </div>
                    <div style="font-size: 14px; line-height: 1.4; margin-bottom: 15px;">
                        Pagamento confirmado automaticamente! Todo o conte√∫do foi desbloqueado. üîì
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        background: rgba(255, 255, 255, 0.2);
                        border: none;
                        color: white;
                        padding: 8px 16px;
                        border-radius: 6px;
                        cursor: pointer;
                        font-size: 12px;
                        font-weight: bold;
                        width: 100%;
                    ">FECHAR</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Remover automaticamente ap√≥s 5 segundos
            setTimeout(() => {
                if (notification && notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }
        
        // Fun√ß√£o para abrir verifica√ß√£o manual de pagamento
        function openManualPaymentCheck() {
            // Criar modal para inserir WhatsApp
            const modal = document.createElement('div');
            modal.id = 'manualPaymentModal';
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 w-full max-w-md mx-auto shadow-2xl">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-2xl">üí∞</span>
                        </div>
                        <h3 class="text-xl font-bold text-gray-900 mb-2">Verificar Pagamento</h3>
                        <p class="text-gray-600 text-sm">Digite seu WhatsApp para verificar se o pagamento foi confirmado</p>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-sm text-gray-600">+55</span>
                            <input 
                                type="tel" 
                                id="manualWhatsappInput" 
                                placeholder="11999999999" 
                                class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent" 
                                maxlength="11"
                                autocomplete="off"
                            >
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="closeManualPaymentModal()" class="flex-1 px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-colors">
                                Cancelar
                            </button>
                            <button onclick="checkManualPayment()" id="checkPaymentBtn" class="flex-1 px-4 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-colors">
                                üîç Verificar
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Configurar input para aceitar apenas n√∫meros
            const input = document.getElementById('manualWhatsappInput');
            if (input) {
                input.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/D/g, '');
                    if (value.length > 11) {
                        value = value.substring(0, 11);
                    }
                    e.target.value = value;
                });
                
                // Focar no input
                setTimeout(() => input.focus(), 100);
                
                // Enter para verificar
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        checkManualPayment();
                    }
                });
            }
        }
        
        function closeManualPaymentModal() {
            const modal = document.getElementById('manualPaymentModal');
            if (modal) {
                modal.remove();
            }
        }
        
        async function checkManualPayment() {
            const input = document.getElementById('manualWhatsappInput');
            const checkBtn = document.getElementById('checkPaymentBtn');
            
            if (!input || !checkBtn) return;
            
            const whatsappValue = input.value.trim();
            
            if (!whatsappValue) {
                alert('Por favor, digite seu n√∫mero de WhatsApp');
                return;
            }
            
            if (whatsappValue.length < 10) {
                alert('Digite um n√∫mero v√°lido (com DDD)');
                return;
            }
            
            // Mostrar loading
            checkBtn.innerHTML = '‚è≥ Verificando...';
            checkBtn.disabled = true;
            
            try {
                console.log('üîç Verifica√ß√£o manual para:', whatsappValue);
                
                const isPaid = await checkPaymentStatus(whatsappValue);
                
                if (isPaid) {
                    console.log('‚úÖ PAGAMENTO CONFIRMADO MANUALMENTE!');
                    
                    // Atualizar estado global
                    globalAuthState.isAuthenticated = true;
                    globalAuthState.user = { whatsapp: whatsappValue };
                    isLoggedIn = true;
                    paymentConfirmed = true;
                    
                    // Salvar no localStorage
                    localStorage.setItem('payment_confirmed', 'true');
                    localStorage.setItem('authenticated_whatsapp', whatsappValue);
                    
                    // Liberar conte√∫do
                    unlockAllContent();
                    
                    // Fechar modal
                    closeManualPaymentModal();
                    
                    // Mostrar mensagem de sucesso
                    showManualSuccessMessage(whatsappValue);
                    
                } else {
                    alert('‚ùå Pagamento n√£o encontrado para este WhatsApp.\n\nVerifique se:\n‚Ä¢ O n√∫mero est√° correto\n‚Ä¢ O pagamento foi realmente efetuado\n‚Ä¢ O pagamento j√° foi processado');
                }
                
            } catch (error) {
                console.error('Erro na verifica√ß√£o manual:', error);
                alert('Erro ao verificar pagamento. Tente novamente.');
            } finally {
                checkBtn.innerHTML = 'üîç Verificar';
                checkBtn.disabled = false;
            }
        }
        
        function showManualSuccessMessage(whatsappNumber) {
            const notification = document.createElement('div');
            notification.innerHTML = `
                <div style="
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: linear-gradient(135deg, #10B981, #059669);
                    color: white;
                    padding: 25px;
                    border-radius: 15px;
                    box-shadow: 0 15px 35px rgba(16, 185, 129, 0.4);
                    z-index: 9999;
                    max-width: 400px;
                    width: 90vw;
                    border: 2px solid rgba(255, 255, 255, 0.2);
                    text-align: center;
                ">
                    <div style="font-size: 48px; margin-bottom: 15px;">üéâ</div>
                    <div style="font-size: 20px; font-weight: bold; margin-bottom: 8px;">
                        ACESSO LIBERADO!
                    </div>
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 15px;">
                        WhatsApp: ${whatsappNumber}
                    </div>
                    <div style="font-size: 16px; line-height: 1.4; margin-bottom: 20px;">
                        ‚úÖ Pagamento confirmado!<br>
                        üîì Todo o conte√∫do foi desbloqueado
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        background: rgba(255, 255, 255, 0.2);
                        border: none;
                        color: white;
                        padding: 10px 20px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 14px;
                        font-weight: bold;
                    ">OK, ENTENDI!</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Remover automaticamente ap√≥s 8 segundos
            setTimeout(() => {
                if (notification && notification.parentElement) {
                    notification.remove();
                }
            }, 8000);
        }

        // Vari√°vel para controlar a verifica√ß√£o de pagamento
        let paymentVerificationInterval = null;
        
        // Fun√ß√£o para iniciar verifica√ß√£o peri√≥dica do pagamento
        function startPaymentVerification(whatsapp) {
            console.log('üîÑ Iniciando verifica√ß√£o de pagamento para:', whatsapp);
            
            // Limpar qualquer verifica√ß√£o anterior
            if (paymentVerificationInterval) {
                clearInterval(paymentVerificationInterval);
            }
            
            // Verificar a cada 10 segundos
            paymentVerificationInterval = setInterval(async () => {
                console.log('üîç Verificando status de pagamento...');
                
                const isPaid = await checkPaymentStatus(whatsapp);
                
                if (isPaid) {
                    console.log('‚úÖ Pagamento confirmado!');
                    
                    // Parar a verifica√ß√£o
                    clearInterval(paymentVerificationInterval);
                    paymentVerificationInterval = null;
                    
                    // Atualizar estado
                    paymentConfirmed = true;
                    globalAuthState.isAuthenticated = true;
                    globalAuthState.user = { whatsapp: whatsapp };
                    isLoggedIn = true;
                    localStorage.setItem('payment_confirmed', 'true');
                    
                    // Mostrar mensagem de parab√©ns
                    showPaymentConfirmedMessage(false); // false = pagamento rec√©m confirmado
                    
                    // LIBERAR TODO O CONTE√öDO AUTOMATICAMENTE
                    unlockAllContent();
                }
            }, 10000); // Verificar a cada 10 segundos
            
            // Parar a verifica√ß√£o ap√≥s 10 minutos para evitar verifica√ß√µes infinitas
            setTimeout(() => {
                if (paymentVerificationInterval) {
                    clearInterval(paymentVerificationInterval);
                    paymentVerificationInterval = null;
                    console.log('‚è∞ Verifica√ß√£o de pagamento encerrada por timeout');
                }
            }, 600000); // 10 minutos
        }
        
        // Fun√ß√£o para mostrar mensagem de pagamento confirmado
        function showPaymentConfirmedMessage(isAlreadyPaid = false) {
            const title = isAlreadyPaid ? 'ACESSO J√Å LIBERADO!' : 'PARAB√âNS!';
            const message = isAlreadyPaid ? 
                'Este WhatsApp j√° tem pagamento confirmado!<br>Voc√™ pode acessar todo o conte√∫do exclusivo.' :
                'Seu pagamento foi confirmado com sucesso!<br>Agora voc√™ pode acessar todo o conte√∫do exclusivo.';
            
            // Criar elemento de notifica√ß√£o
            const notification = document.createElement('div');
            notification.innerHTML = `
                <div style="
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: linear-gradient(135deg, #10B981, #059669);
                    color: white;
                    padding: 2rem;
                    border-radius: 1rem;
                    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
                    z-index: 10000;
                    text-align: center;
                    max-width: 400px;
                    animation: slideIn 0.5s ease-out;
                " id="paymentNotification">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üéâ</div>
                    <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1rem;">${title}</h2>
                    <p style="margin-bottom: 1.5rem; line-height: 1.6;">
                        ${message}
                    </p>
                    <button onclick="closePaymentNotification()" style="
                        background: white;
                        color: #059669;
                        border: none;
                        padding: 0.75rem 2rem;
                        border-radius: 0.5rem;
                        font-weight: bold;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        USAR ABA ENTRAR
                    </button>
                </div>
                <div style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.5);
                    z-index: 9999;
                " onclick="closePaymentNotification()"></div>
                <style>
                    @keyframes slideIn {
                        from {
                            opacity: 0;
                            transform: translate(-50%, -50%) scale(0.8);
                        }
                        to {
                            opacity: 1;
                            transform: translate(-50%, -50%) scale(1);
                        }
                    }
                </style>
            `;
            
            document.body.appendChild(notification);
        }
        
        // Fun√ß√£o para fechar notifica√ß√£o de pagamento
        function closePaymentNotification() {
            const notification = document.getElementById('paymentNotification');
            if (notification) {
                notification.parentElement.remove();
            }
            
            // Mudar automaticamente para aba "Entrar"
            showLoginTab();
        }
        
        // Fun√ß√£o para habilitar aba de login
        function enableLoginTab() {
            const loginTab = document.getElementById('loginTab');
            const registerTab = document.getElementById('registerTab');
            
            if (loginTab) {
                loginTab.classList.remove('opacity-50', 'cursor-not-allowed');
                loginTab.style.pointerEvents = 'auto';
                loginTab.style.cursor = 'pointer';
                
                // Adicionar indicador visual de que pode acessar
                loginTab.innerHTML = 'Entrar ‚úÖ';
                loginTab.style.background = 'linear-gradient(135deg, #10B981, #059669)';
                loginTab.style.color = 'white';
                loginTab.style.fontWeight = 'bold';
            }
            
            if (registerTab) {
                registerTab.classList.add('opacity-50', 'cursor-not-allowed');
                registerTab.style.pointerEvents = 'none';
                registerTab.innerHTML = 'Cadastro ‚úì';
                registerTab.title = 'Cadastro j√° realizado e pagamento confirmado. Use a aba Entrar.';
            }
        }
        
        // Fun√ß√µes para controlar abas do modal
        function showLoginTab() {
            // S√≥ permitir se pagamento foi confirmado
            if (!paymentConfirmed) {
                alert('Acesso bloqueado. Complete sua compra primeiro na aba Cadastro.');
                return;
            }
            
            document.getElementById('loginTab').classList.add('text-blue-600', 'border-blue-600');
            document.getElementById('loginTab').classList.remove('text-gray-500', 'border-transparent', 'opacity-50', 'cursor-not-allowed');
            document.getElementById('registerTab').classList.add('text-gray-500', 'border-transparent', 'opacity-50', 'cursor-not-allowed');
            document.getElementById('registerTab').classList.remove('text-blue-600', 'border-blue-600');
            document.getElementById('loginTabContent').classList.remove('hidden');
            document.getElementById('registerTabContent').classList.add('hidden');
        }
        
        function showRegisterTab() {
            // S√≥ permitir se pagamento N√ÉO foi confirmado
            if (paymentConfirmed) {
                return; // N√£o permitir voltar para cadastro se j√° pagou
            }
            
            document.getElementById('registerTab').classList.add('text-blue-600', 'border-blue-600');
            document.getElementById('registerTab').classList.remove('text-gray-500', 'border-transparent');
            document.getElementById('loginTab').classList.add('text-gray-500', 'border-transparent', 'opacity-50', 'cursor-not-allowed');
            document.getElementById('loginTab').classList.remove('text-blue-600', 'border-blue-600');
            document.getElementById('registerTabContent').classList.remove('hidden');
            document.getElementById('loginTabContent').classList.add('hidden');
        }

        // Estado de status online/offline da modelo
        let modelOnlineStatus = true; // true = online, false = offline
        
        function toggleModelStatus() {
            modelOnlineStatus = !modelOnlineStatus;
            updateChatStatus();
        }
        
        function updateChatStatus() {
            const statusIndicator = document.getElementById('chatStatus');
            const statusText = document.getElementById('chatStatusText');
            
            if (statusIndicator && statusText) {
                if (modelOnlineStatus) {
                    statusIndicator.className = 'w-3 h-3 bg-green-500 rounded-full animate-pulse';
                    statusText.textContent = 'Online';
                    statusText.className = 'text-green-500 text-sm font-medium';
                } else {
                    statusIndicator.className = 'w-3 h-3 bg-red-500 rounded-full animate-pulse';
                    statusText.textContent = 'Offline';
                    statusText.className = 'text-red-500 text-sm font-medium';
                }
            }
        }

        // Fun√ß√£o para abrir chat externo
        function openChatExternal() {
            const chatLinkUrl = '';
            if (chatLinkUrl && chatLinkUrl.trim() !== '') {
                window.open(chatLinkUrl, '_blank');
            } else {
                // Link padr√£o caso n√£o tenha configurado
                window.open('/chat/modelo', '_blank');
            }
        }
        
        // Mostrar avatar ap√≥s carregamento
        window.addEventListener('load', function() {
            const floatingAvatar = document.getElementById('floatingAvatar');
            if (floatingAvatar) {
                floatingAvatar.style.display = 'block';
            }
        });

        function openHomeLink() {
            const chatLinkUrl = '';
            if (chatLinkUrl && chatLinkUrl.trim() !== '') {
                window.open(chatLinkUrl, '_blank');
            }
        }
        
        // Estado global de autentica√ß√£o que persiste entre abas
        let globalAuthState = {
            isAuthenticated: false,
            user: null
        };
        
        // Tracking function for webhook events
        function trackEvent(eventType, data = {}) {
            const webhookUrl = '';
            const enabledEvents = 'click,submit,view'.split(',').map(e => e.trim());
            
            if (webhookUrl && enabledEvents.includes(eventType)) {
                const eventData = {
                    event: eventType,
                    timestamp: new Date().toISOString(),
                    page: window.location.href,
                    userAgent: navigator.userAgent,
                    ...data
                };
                
                // Send to webhook (fire and forget)
                fetch(webhookUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(eventData),
                    mode: 'no-cors'
                }).catch(() => {}); // Ignore errors silently
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
            setupTabSwitching();
            setupModalFunctionality();
            checkStoredLogin();
            setupWhatsAppInput();
            
            // ‚úÖ VERIFICA√á√ÉO AUTOM√ÅTICA DE PAGAMENTO - NOVA FUNCIONALIDADE
            checkAutoPayment();
            
            trackEvent('view', { page_type: 'profile' });
            
            // Renderizar primeira p√°gina por padr√£o
            renderImagesPage(1);
        });
        
        function setupWhatsAppInput() {
            const whatsappInput = document.getElementById('registerWhatsapp');
            if (whatsappInput) {
                // Permitir apenas n√∫meros e limitar a 11 d√≠gitos
                whatsappInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/D/g, '');
                    
                    // Limitar a 11 d√≠gitos (DDD + n√∫mero)
                    if (value.length > 11) {
                        value = value.substring(0, 11);
                    }
                    
                    e.target.value = value;
                });
                
                // Permitir teclas de navega√ß√£o e delete
                whatsappInput.addEventListener('keydown', function(e) {
                    // Permitir: backspace, delete, tab, escape, enter, setas
                    if ([8, 9, 27, 13, 46, 37, 39, 38, 40].indexOf(e.keyCode) !== -1 ||
                        // Permitir Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X
                        (e.keyCode === 65 && e.ctrlKey === true) || 
                        (e.keyCode === 67 && e.ctrlKey === true) || 
                        (e.keyCode === 86 && e.ctrlKey === true) || 
                        (e.keyCode === 88 && e.ctrlKey === true)) {
                        return;
                    }
                    // Garantir que √© um n√∫mero
                    if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                        e.preventDefault();
                    }
                });
            }
        }
        
        function initializeEventListeners() {
            // Bot√µes que abrem o modal de cadastro
            const subscribeButtons = ['subscribeBtn', 'sidebarSubscribeBtn'];
            subscribeButtons.forEach(id => {
                const btn = document.getElementById(id);
                if (btn) btn.addEventListener('click', () => openSubscriptionModal());
            });
            
            // Bot√£o purchase no modal que tamb√©m redireciona mas verifica registro
            const purchaseBtn = document.getElementById('purchaseBtn');
            if (purchaseBtn) {
                purchaseBtn.removeAttribute('onclick'); // Remove inline onclick
                purchaseBtn.addEventListener('click', () => handlePurchase());
            }
            
            const likeBtn = document.getElementById('likeBtn');
            if (likeBtn) likeBtn.addEventListener('click', handleLike);
            
            // N√£o adicionar listeners de modal se usu√°rio estiver logado
            updateContentAccess();
        }
        
        function setupTabSwitching() {
            const postsTab = document.getElementById('postsTab');
            const videosTab = document.getElementById('videosTab');
            
            if (postsTab) {
                postsTab.addEventListener('click', () => {
                    showImagesTab();
                });
            }
            
            if (videosTab) {
                videosTab.addEventListener('click', () => {
                    showVideosTab();
                });
            }
        }
        
        function setupModalFunctionality() {
            const modal = document.getElementById('subscriptionModal');
            const closeBtn = document.getElementById('closeModal');
            
            if (closeBtn) {
                closeBtn.addEventListener('click', closeSubscriptionModal);
                if (modal) {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) closeSubscriptionModal();
                    });
                }
            }
        }
        
        function openSubscriptionModal() {
            if (globalAuthState.isAuthenticated) {
                return; // N√£o abrir modal se j√° estiver autenticado
            }
            trackEvent('click', { element: 'subscription-modal', action: 'open' });
            const modal = document.getElementById('subscriptionModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.style.display = 'flex';
                
                // SEMPRE abrir na aba "Cadastro"
                showRegisterTab();
                
                // Por padr√£o, desabilitar aba "Entrar"
                const loginTab = document.getElementById('loginTab');
                if (loginTab) {
                    loginTab.classList.add('opacity-50', 'cursor-not-allowed');
                    loginTab.style.pointerEvents = 'none';
                }
                
                // Verificar se j√° tem WhatsApp registrado e pagamento confirmado via Supabase
                const registeredWhatsapp = localStorage.getItem('registered_whatsapp');
                if (registeredWhatsapp) {
                    console.log('üîç Verificando status de pagamento para WhatsApp registrado:', registeredWhatsapp);
                    
                    // Verificar status de pagamento via webhook da Supabase
                    checkPaymentStatus(registeredWhatsapp).then(isPaid => {
                        if (isPaid) {
                            console.log('‚úÖ Pagamento j√° confirmado!');
                            paymentConfirmed = true;
                            globalAuthState.isAuthenticated = true;
                            globalAuthState.user = { whatsapp: registeredWhatsapp };
                            isLoggedIn = true;
                            localStorage.setItem('payment_confirmed', 'true');
                            
                            // LIBERAR TODO O CONTE√öDO AUTOMATICAMENTE
                            unlockAllContent();
                            
                            // Mostrar mensagem de boas-vindas
                            setTimeout(() => {
                                alert('üéâ Bem-vindo de volta! Seu pagamento j√° foi confirmado e o conte√∫do foi liberado automaticamente.');
                            }, 500);
                        } else {
                            // Se n√£o est√° pago, mas tem WhatsApp registrado, iniciar verifica√ß√£o
                            console.log('üí≥ WhatsApp registrado mas pagamento pendente. Iniciando verifica√ß√£o...');
                            startPaymentVerification(registeredWhatsapp);
                        }
                    }).catch(error => {
                        console.error('Erro ao verificar pagamento:', error);
                    });
                }
            }
        }
        
        function closeSubscriptionModal() {
            trackEvent('click', { element: 'subscription-modal', action: 'close' });
            const modal = document.getElementById('subscriptionModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.style.display = 'none';
            }
        }

        // Fun√ß√µes para modal das modelos
        let allModelos = []; // Armazenar todas as modelos para busca
        let searchTimeout;
        
        async function openModelosModal() {
            const modal = document.getElementById('modelosModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.style.display = 'flex';
                await loadModelos();
            }
        }

        function closeModelosModal() {
            const modal = document.getElementById('modelosModal');
            const searchInput = document.getElementById('modelosSearchInput');
            if (modal) {
                modal.classList.add('hidden');
                modal.style.display = 'none';
            }
            if (searchInput) {
                searchInput.value = '';
            }
        }

        async function searchModelos(termo) {
            // Debounce: buscar ap√≥s 500ms de pausa na digita√ß√£o
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(async () => {
                const container = document.getElementById('modelosContainer');
                const loading = document.getElementById('modelosLoading');
                
                if (loading) loading.style.display = 'block';
                if (container) container.innerHTML = '';
                
                try {
                    let url = 'https://uxbfahumhkguuddrmlfu.supabase.co/rest/v1/models?is_active=eq.true';
                    
                    // Se h√° termo de busca, filtrar por nome ou username
                    if (termo.trim()) {
                        url += '&or=(name.like.*' + termo + '*,username.like.*' + termo + '*)';
                    }
                    
                    const response = await fetch(url, {
                        headers: {
                            'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4YmZhaHVtaGtndXVkZHJtbGZ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxNTI5OTIsImV4cCI6MjA3MDcyODk5Mn0.Pgw4338wWXyX-CUEayY4_kYJ7MS0L-oWiLLsAqOo9LI',
                            'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4YmZhaHVtaGtndXVkZHJtbGZ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxNTI5OTIsImV4cCI6MjA3MDcyODk5Mn0.Pgw4338wWXyX-CUEayY4_kYJ7MS0L-oWiLLsAqOo9LI'
                        }
                    });
                    
                    const modelos = await response.json();
                    
                    if (loading) loading.style.display = 'none';
                    
                    if (modelos && modelos.length > 0) {
                        displayModelos(modelos);
                    } else {
                        if (container) {
                            const mensagem = termo.trim() ? 
                                'Nenhuma modelo encontrada para "' + termo + '". Tente buscar por outro nome.' : 
                                'Nenhuma modelo encontrada no momento.';
                            container.innerHTML = '<p class="text-center text-gray-500 py-8 col-span-full">' + mensagem + '</p>';
                        }
                    }
                } catch (error) {
                    console.error('Erro ao buscar modelos:', error);
                    if (loading) loading.style.display = 'none';
                    if (container) {
                        container.innerHTML = '<p class="text-center text-red-500 py-8 col-span-full">Erro ao buscar modelos. Tente novamente.</p>';
                    }
                }
            }, 500);
        }

        async function loadModelos() {
            const container = document.getElementById('modelosContainer');
            const loading = document.getElementById('modelosLoading');
            
            if (loading) loading.style.display = 'block';
            if (container) container.innerHTML = '';
            
            try {
                const response = await fetch('https://uxbfahumhkguuddrmlfu.supabase.co/rest/v1/models?is_active=eq.true', {
                    headers: {
                        'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4YmZhaHVtaGtndXVkZHJtbGZ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxNTI5OTIsImV4cCI6MjA3MDcyODk5Mn0.Pgw4338wWXyX-CUEayY4_kYJ7MS0L-oWiLLsAqOo9LI',
                        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4YmZhaHVtaGtndXVkZHJtbGZ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxNTI5OTIsImV4cCI6MjA3MDcyODk5Mn0.Pgw4338wWXyX-CUEayY4_kYJ7MS0L-oWiLLsAqOo9LI'
                    }
                });
                
                const modelos = await response.json();
                
                if (loading) loading.style.display = 'none';
                
                if (modelos && modelos.length > 0) {
                    displayModelos(modelos);
                } else {
                    if (container) {
                        container.innerHTML = '<p class="text-center text-gray-500 py-8">Nenhuma modelo encontrada no momento.</p>';
                    }
                }
            } catch (error) {
                console.error('Erro ao carregar modelos:', error);
                if (loading) loading.style.display = 'none';
                if (container) {
                    container.innerHTML = '<p class="text-center text-red-500 py-8">Erro ao carregar modelos. Tente novamente.</p>';
                }
            }
        }

        function displayModelos(modelos) {
            const container = document.getElementById('modelosContainer');
            if (!container) return;
            
            container.innerHTML = modelos.map(modelo => `
                <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300 border">
                    <div class="aspect-w-16 aspect-h-9">
                        <img src="${modelo.avatar_url || 'https://images.unsplash.com/photo-1494790108755-2616c345834c?w=300&h=300&fit=crop&crop=face'}" 
                             alt="${modelo.name || 'Modelo'}" 
                             class="w-full h-48 object-cover"
                             onerror="this.src='https://images.unsplash.com/photo-1494790108755-2616c345834c?w=300&h=300&fit=crop&crop=face'"
                        />
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-lg text-gray-900 mb-1">${modelo.name || 'Nome n√£o informado'}</h3>
                        <p class="text-gray-600 text-sm mb-1">@${modelo.username || ''}</p>
                        ${modelo.bio ? `<p class="text-gray-500 text-sm mb-3 line-clamp-2">${modelo.bio}</p>` : ''}
                        <div class="flex items-center justify-between text-xs text-gray-600 mb-3">
                            <span>üë• ${modelo.followers_count || 0} seguidores</span>
                            <span>üëÅÔ∏è ${modelo.total_views || 0} visualiza√ß√µes</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${modelo.is_live ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                ${modelo.is_live ? 'üü¢ Online' : 'üî¥ Offline'}
                            </span>
                            <button 
                                class="bg-purple-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-purple-700 transition-colors"
                                onclick="accessModelo('${modelo.id}', '${modelo.onlyfans_link || ''}')"
                            >
                                ${modelo.onlyfans_link ? 'Acessar' : 'Sem Link'}
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function accessModelo(modeloId, onlyfansLink) {
            if (onlyfansLink && onlyfansLink.trim() !== '') {
                window.open(onlyfansLink, '_blank');
            } else {
                alert('Link n√£o dispon√≠vel para esta modelo');
            }
        }
        

        function handlePurchase() {
            const registeredWhatsapp = localStorage.getItem('registered_whatsapp');
            const paymentUrlFromEditor = 'https://p.hoopay.com.br/v/bab813ea-b121-4efb-a61a-63aec3ba3a45';
            const fallbackChatLink = '';
            const fallbackHome = '';
            const paymentUrl = (paymentUrlFromEditor && paymentUrlFromEditor.trim()) || (fallbackChatLink && fallbackChatLink.trim()) || (fallbackHome && fallbackHome.trim()) || '';
            console.log('üîó PaymentUrl selecionado:', paymentUrl, { paymentUrlFromEditor, fallbackChatLink, fallbackHome });
            
            // Verificar se o usu√°rio fez o cadastro primeiro
            if (!registeredWhatsapp) {
                alert('PARA TER ACESSO A PAGINA DE VENDAS √â PRECISO PREENCHER O CADASTRO APOS ISSO CLICAR EM COMPRAR CONTEUDO, AI SERA LIBERADO O SEU ACESSO PARA ENTRAR NOS CONTEUDOS');
                // Muda para a aba de cadastro automaticamente
                showRegisterTab();
                return;
            }
            
            if (registeredWhatsapp) {
                console.log('Contato registrado:', registeredWhatsapp);
                console.log('üîó PaymentUrl no HTML:', paymentUrl);
                console.log('üîó PaymentUrl v√°lido?', !!paymentUrl && paymentUrl.trim() !== '');
                trackEvent('submit', { element: 'purchase-button', price: '1,00', contact: registeredWhatsapp });
                
                if (paymentUrl && paymentUrl.trim()) {
                    // Usar URL configurada no editor, incluindo WhatsApp como par√¢metro
                    const separator = paymentUrl.includes('?') ? '&' : '?';
                    const finalUrl = paymentUrl + separator + 'custom_whatsapp=' + encodeURIComponent(registeredWhatsapp);
                    window.open(finalUrl, '_blank');
                } else {
                    alert('‚ö†Ô∏è Configure o Link da P√°gina de Pagamento no menu lateral antes de efetuar compras.');
                    return;
                }
                
                // Informar ao usu√°rio sobre o processo autom√°tico
                alert('üöÄ Redirecionando para pagamento! Ap√≥s confirmar o pagamento, voc√™ poder√° fazer login automaticamente com seu WhatsApp.');
                
            } else {
                alert('‚ö†Ô∏è Por favor, fa√ßa seu cadastro com WhatsApp antes de efetuar a compra.');
            }
        }
        
        function checkStoredLogin() {
            // SEGURAN√áA: NUNCA confiar apenas no sessionStorage
            // Sempre verificar com o backend se o pagamento foi confirmado
            console.log('üîí Verifica√ß√£o de seguran√ßa: sessionStorage ser√° ignorado para evitar bypass');
            
            // Limpar qualquer sess√£o local para evitar bypass
            sessionStorage.removeItem('onyfans_user_session');
            localStorage.removeItem('registered_whatsapp');
            localStorage.removeItem('payment_confirmed');
            
            // Garantir que o usu√°rio sempre fa√ßa login v√°lido
            globalAuthState.isAuthenticated = false;
            globalAuthState.user = null;
            isLoggedIn = false;
            
            console.log('üîí Sistema protegido: usu√°rio deve fazer login v√°lido com pagamento confirmado');
        }
        
        async function handleAccess() {
            const loginEmail = document.getElementById('loginEmail').value;
            
            if (!loginEmail) {
                alert('‚ö†Ô∏è Por favor, preencha o campo de WhatsApp.');
                return;
            }
            
            // Limpar e validar o n√∫mero
            const whatsappNumber = loginEmail.replace(/D/g, '');
            if (whatsappNumber.length < 10 || whatsappNumber.length > 11) {
                alert('‚ö†Ô∏è Por favor, digite um n√∫mero de WhatsApp v√°lido (DDD + n√∫mero). Exemplo: 11982969676');
                return;
            }

            try {
                console.log('üîí SEGURAN√áA: Iniciando valida√ß√£o rigorosa para:', whatsappNumber);
                
                // Chamada OBRIGAT√ìRIA para Edge Function que verifica pagamento
                const fullPhone = '+55' + whatsappNumber;
                
                console.log('üîí Verificando no backend se pagamento foi confirmado para:', fullPhone);
                
                const response = await fetch('https://uxbfahumhkguuddrmlfu.supabase.co/functions/v1/check-payment-status', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4YmZhaHVtaGtndXVkZHJtbGZ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxNTI5OTIsImV4cCI6MjA3MDcyODk5Mn0.Pgw4338wWXyX-CUEayY4_kYJ7MS0L-oWiLLsAqOo9LI'
                    },
                    body: JSON.stringify({ 
                        whatsapp: whatsappNumber,
                        modelId: 'e2ec4484-2e99-4d71-b717-47f0782dbc50',
                        pageId: '6b02a09a-8e83-4ae8-8c20-4688586b80f8'
                    })
                });

                if (!response.ok) {
                    throw new Error('Falha na comunica√ß√£o com servidor. Status: ' + response.status);
                }

                const result = await response.json();
                
                console.log('üîí Resposta do servidor:', result);
                
                // VALIDA√á√ÉO RIGOROSA: s√≥ libera se backend confirmar pagamento
                if (!result.success || !result.canLogin) {
                    console.error('üîí ACESSO NEGADO:', result.message);
                    throw new Error(result.message || 'Acesso negado pelo sistema de seguran√ßa');
                }
                
                // DUPLA VERIFICA√á√ÉO: confirmar que status √© "paid"
                if (result.status !== 'paid') {
                    console.error('üîí PAGAMENTO N√ÉO CONFIRMADO para:', fullPhone);
                    throw new Error('Pagamento n√£o confirmado. Complete sua compra primeiro.');
                }
                
                console.log('‚úÖ SEGURAN√áA: Login aprovado pelo backend para usu√°rio com pagamento confirmado');

                // SOMENTE AQUI o acesso √© liberado
                const user = { whatsapp: fullPhone, status: result.status };
                
                // Salvar sess√£o APENAS ap√≥s valida√ß√£o completa
                sessionStorage.setItem('onyfans_user_session', JSON.stringify(user));
                
                // Salvar confirma√ß√£o de pagamento no localStorage
                localStorage.setItem('payment_confirmed', 'true');
                
                globalAuthState.isAuthenticated = true;
                globalAuthState.user = user;
                isLoggedIn = true;
                
                unlockAllContent();
                trackEvent('submit', { element: 'whatsapp_login_confirmed', phone: user.whatsapp });
                
                const registerTab = document.getElementById('registerTab');
                if (registerTab) {
                    registerTab.style.opacity = '0.5';
                    registerTab.style.pointerEvents = 'none';
                    registerTab.title = 'Cadastro j√° realizado e pagamento confirmado.';
                    registerTab.textContent = 'Cadastro ‚úì';
                }
                
                alert('üéâ PARAB√âNS! Login realizado com sucesso! Seu pagamento foi confirmado. Agora √© s√≥ acessar com seu n√∫mero!');
                
                // Fechar modal
                closeSubscriptionModal();
                
            } catch (error) {
                console.error('üîí ERRO DE SEGURAN√áA:', error);
                
                // Limpar qualquer dados locais em caso de erro
                sessionStorage.removeItem('onyfans_user_session');
                localStorage.removeItem('payment_confirmed');
                globalAuthState.isAuthenticated = false;
                globalAuthState.user = null;
                isLoggedIn = false;
                
                alert('‚ùå ' + error.message);
            }
        }
        
        async function handleWhatsAppRegister() {
            const registerWhatsapp = document.getElementById('registerWhatsapp').value;
            
            if (!registerWhatsapp || registerWhatsapp.trim() === '') {
                alert('‚ö†Ô∏è Por favor, preencha o campo de WhatsApp para se cadastrar.');
                return;
            }
            
            // Validar formato b√°sico do WhatsApp (s√≥ n√∫meros, DDD + n√∫mero)
            const whatsappNumber = registerWhatsapp.replace(/D/g, '');
            if (whatsappNumber.length < 10 || whatsappNumber.length > 11) {
                alert('‚ö†Ô∏è Por favor, digite um n√∫mero de WhatsApp v√°lido (DDD + n√∫mero). Exemplo: 11982969676');
                return;
            }

            try {
                const fullPhone = '+55' + whatsappNumber;

                // 0) Verificar se o WhatsApp j√° est√° cadastrado na base
                const candidates = [
                    whatsappNumber,
                    whatsappNumber.startsWith('55') ? whatsappNumber.substring(2) : ('55' + whatsappNumber),
                    whatsappNumber.startsWith('55') ? ('+' + whatsappNumber) : ('+55' + whatsappNumber)
                ].filter(function(v, i, a) { return a.indexOf(v) === i; });

                try {
                    const orParam = encodeURIComponent('(' + candidates.map(function(c){ return 'whatsapp.eq.' + c; }).join(',') + ')');
                    const checkUrl = 'https://uxbfahumhkguuddrmlfu.supabase.co/rest/v1/whatsapp_registrations?select=id,whatsapp,status&or=' + orParam + '&limit=1';
                    const existingResp = await fetch(checkUrl, {
                        headers: {
                            'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4YmZhaHVtaGtndXVkZHJtbGZ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxNTI5OTIsImV4cCI6MjA3MDcyODk5Mn0.Pgw4338wWXyX-CUEayY4_kYJ7MS0L-oWiLLsAqOo9LI',
                            'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4YmZhaHVtaGtndXVkZHJtbGZ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxNTI5OTIsImV4cCI6MjA3MDcyODk5Mn0.Pgw4338wWXyX-CUEayY4_kYJ7MS0L-oWiLLsAqOo9LI'
                        }
                    });
                    const existing = await existingResp.json();
                    if (Array.isArray(existing) && existing.length > 0) {
                        alert('‚ö†Ô∏è Esse n√∫mero j√° est√° cadastrado. Tente outro n√∫mero de compra.');
                        return; // Impedir novo cadastro com o mesmo n√∫mero
                    }
                } catch (dupErr) {
                    console.warn('Aviso ao checar duplicidade:', dupErr);
                }

                console.log('üîç Verificando se WhatsApp j√° est√° pago:', whatsappNumber);
                
                // PRIMEIRO: Verificar se esse n√∫mero j√° tem pagamento confirmado
                const isPaid = await checkPaymentStatus(whatsappNumber);
                
                if (isPaid) {
                    console.log('‚úÖ N√öMERO J√Å PAGO! Liberando acesso direto...');
                    
                    // Salvar como registrado
                    localStorage.setItem('registered_whatsapp', fullPhone);
                    localStorage.setItem('payment_confirmed', 'true');
                    paymentConfirmed = true;
                    globalAuthState.isAuthenticated = true;
                    globalAuthState.user = { whatsapp: fullPhone };
                    isLoggedIn = true;
                    
                    // Mostrar mensagem de parab√©ns
                    showPaymentConfirmedMessage(true); // true = j√° era pago
                    
                    // LIBERAR TODO O CONTE√öDO AUTOMATICAMENTE
                    unlockAllContent();
                    
                    return; // N√£o precisa fazer cadastro, j√° est√° pago
                }
                
                console.log('üí≥ N√∫mero n√£o pago, prosseguindo com cadastro:', whatsappNumber);
                
                // SEGUNDO: Se n√£o est√° pago, fazer cadastro normal
                console.log('Processando cadastro para:', fullPhone);
                
                console.log('Fazendo requisi√ß√£o para Edge Function...');
                
                const response = await fetch('https://uxbfahumhkguuddrmlfu.supabase.co/functions/v1/whatsapp-register-model', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4YmZhaHVtaGtndXVkZHJtbGZ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxNTI5OTIsImV4cCI6MjA3MDcyODk5Mn0.Pgw4338wWXyX-CUEayY4_kYJ7MS0L-oWiLLsAqOo9LI'
                    },
                    body: JSON.stringify({ 
                        whatsapp: whatsappNumber,
                        modelId: 'e2ec4484-2e99-4d71-b717-47f0782dbc50',
                        modelUsername: '@niacruzxo',
                        pageId: '6b02a09a-8e83-4ae8-8c20-4688586b80f8',
                        email: null,
                        name: null
                    })
                });

                console.log('Resposta da Edge Function:', {
                    status: response.status,
                    statusText: response.statusText,
                    ok: response.ok
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Erro detalhado da API:', errorText);
                    throw new Error('Erro na API: ' + response.status + ' - ' + errorText);
                }

                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Erro desconhecido ao registrar WhatsApp');
                }
                
                console.log('Cadastro realizado no Supabase:', result);

                // Salvar WhatsApp no localStorage
                localStorage.setItem('registered_whatsapp', result.whatsapp);
                
                // Verificar se j√° est√° pago na resposta do cadastro
                if (result.status === 'paid' && result.canLogin === true) {
                    console.log('‚úÖ CADASTRO RETORNOU: J√Å EST√Å PAGO! Liberando acesso...');
                    
                    // Salvar como confirmado
                    localStorage.setItem('payment_confirmed', 'true');
                    paymentConfirmed = true;
                    globalAuthState.isAuthenticated = true;
                    globalAuthState.user = { whatsapp: result.whatsapp };
                    isLoggedIn = true;
                    
                    // Mostrar mensagem de parab√©ns
                    showPaymentConfirmedMessage(true); // true = j√° era pago
                    
                    // LIBERAR TODO O CONTE√öDO AUTOMATICAMENTE
                    unlockAllContent();
                    
                    trackEvent('submit', { element: 'whatsapp_register_already_paid', whatsapp: result.whatsapp });
                    
                    return; // N√£o precisa mostrar bot√£o comprar nem verificar pagamento
                }
                
                // Se n√£o est√° pago, seguir fluxo normal
                trackEvent('submit', { element: 'whatsapp_register', whatsapp: result.whatsapp });
                
                // Mostrar bot√£o COMPRAR na aba cadastro
                const buyButtonContainer = document.getElementById('buyButtonContainer');
                if (buyButtonContainer) {
                    buyButtonContainer.classList.remove('hidden');
                }
                
                alert('‚úÖ Cadastro realizado com sucesso! Agora clique no bot√£o "COMPRAR" abaixo para efetuar sua compra. Ap√≥s o pagamento, voc√™ poder√° acessar seu conte√∫do exclusivo!');
                
                // Iniciar verifica√ß√£o peri√≥dica do status de pagamento
                startPaymentVerification(result.whatsapp);
                
                // N√ÉO fechar modal - deixar aberto na aba de cadastro
                
            } catch (error) {
                console.error('Erro completo no cadastro:', error);
                console.error('Error message:', error.message);
                console.error('Error stack:', error.stack);
                
                let errorMessage = 'Erro desconhecido no cadastro';
                if (error.message) {
                    errorMessage = error.message;
                }
                
                alert('‚ùå ' + errorMessage);
            }
        }
        
        function unlockAllContent() {
            // Fechar modal
            closeSubscriptionModal();
            
            console.log('üîì Liberando todo o conte√∫do...');
            
            // Remover todos os overlays de bloqueio
            document.querySelectorAll('.lock-overlay').forEach(overlay => {
                overlay.remove();
            });
            
            // Desbloquear todas as imagens e v√≠deos removendo completamente o blur
            document.querySelectorAll('img, video').forEach(media => {
                media.classList.remove('blur-sm');
                media.style.filter = 'none !important';
                media.style.transition = 'filter 0.3s ease';
                // For√ßar remo√ß√£o do blur aplicado via CSS
                media.style.cssText += 'filter: none !important; -webkit-filter: none !important;';
            });
            
            // Remover blur dos containers de imagem e v√≠deo e adicionar classe unlocked
            document.querySelectorAll('.image-item, .video-item').forEach(container => {
                container.classList.add('unlocked');
                const media = container.querySelector('img, video');
                if (media) {
                    media.style.filter = 'none !important';
                    media.style.cssText += 'filter: none !important; -webkit-filter: none !important;';
                }
            });
            
            // Re-renderizar a aba vis√≠vel para garantir estado limpo
            const imagesGrid = document.getElementById('imagesGrid');
            if (imagesGrid && imagesGrid.classList.contains('hidden')) {
                renderVideosPage(currentVideoPage);
            } else {
                renderImagesPage(currentImagePage);
            }
            
            // Atualizar o acesso ao conte√∫do
            updateContentAccess();
            
            console.log('‚úÖ Conte√∫do totalmente liberado!');
            setTimeout(() => {
                alert('‚úÖ Conte√∫do desbloqueado! Aproveite todo o conte√∫do exclusivo sem restri√ß√µes.');
            }, 1000);
        }
        
        function updateContentAccess() {
            // Remover event listeners de modal de TODOS os elementos de conte√∫do
            document.querySelectorAll('.image-item, .video-item').forEach(item => {
                // Clone o elemento para remover TODOS os event listeners
                const newItem = item.cloneNode(true);
                
                // Se estiver logado, adicionar evento para abrir popup de visualiza√ß√£o
                if (globalAuthState.isAuthenticated) {
                    newItem.addEventListener('click', function() {
                        const mediaType = item.classList.contains('image-item') ? 'image' : 'video';
                        const mediaSrc = mediaType === 'image' 
                            ? item.querySelector('img').src 
                            : item.querySelector('video source').src;
                        openMediaPopup(mediaSrc, mediaType);
                    });
                } else {
                    // Se n√£o estiver logado, abrir modal de login
                    newItem.addEventListener('click', openSubscriptionModal);
                }
                
                item.parentNode.replaceChild(newItem, item);
            });
        }
        
        function openMediaPopup(mediaSrc, mediaType) {
            // Criar popup para visualizar m√≠dia
            const popup = document.createElement('div');
            popup.id = 'mediaPopup';
            popup.className = 'fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4';
            popup.style.display = 'flex';
            
            const mediaElement = mediaType === 'image' 
                ? `<img src="${mediaSrc}" class="max-w-full max-h-full object-contain rounded-lg">`
                : `<video src="${mediaSrc}" class="max-w-full max-h-full object-contain rounded-lg" controls autoplay>`;
            
            popup.innerHTML = `
                <div class="relative max-w-4xl max-h-full">
                    <button onclick="closeMediaPopup()" class="absolute -top-4 -right-4 bg-white text-black rounded-full w-10 h-10 flex items-center justify-center text-xl font-bold hover:bg-gray-200 z-10">
                        √ó
                    </button>
                    ${mediaElement}
                </div>
            `;
            
            // Fechar ao clicar fora
            popup.addEventListener('click', function(e) {
                if (e.target === popup) {
                    closeMediaPopup();
                }
            });
            
            document.body.appendChild(popup);
        }
        
        function closeMediaPopup() {
            const popup = document.getElementById('mediaPopup');
            if (popup) {
                popup.remove();
            }
        }
        
        function shareContent() {
            try {
                const currentUrl = window.location.href || 'https://example.com';
                const shareText = 'Veja meu conte√∫do exclusivo! ' + currentUrl;
                const whatsappUrl = 'https://wa.me/?text=' + encodeURIComponent(shareText);
                window.open(whatsappUrl, '_blank');
                trackEvent('click', { element: 'share-button', platform: 'whatsapp' });
            } catch (error) {
                const whatsappUrl = 'https://wa.me/?text=' + encodeURIComponent('Veja meu conte√∫do exclusivo!');
                window.open(whatsappUrl, '_blank');
                trackEvent('click', { element: 'share-button', platform: 'whatsapp' });
            }
        }
        
        function handleLike() {
            isLiked = !isLiked;
            trackEvent('click', { element: 'like-button', liked: isLiked, count: currentLikeCount });
            const likeIcon = document.getElementById('likeIcon');
            const likeCount = document.getElementById('likeCount');
            const likeAnimation = document.getElementById('likeAnimation');
            
            if (isLiked) {
                currentLikeCount++;
                likeIcon.className = 'fas fa-heart text-4xl text-red-500 animate-pulse';
                likeCount.className = 'text-3xl font-bold text-red-500';
                if (likeAnimation) {
                    likeAnimation.classList.remove('hidden');
                    likeAnimation.classList.add('flex');
                    
                    setTimeout(() => {
                        likeAnimation.classList.add('hidden');
                        likeAnimation.classList.remove('flex');
                    }, 2000);
                }
            } else {
                currentLikeCount = Math.max(0, currentLikeCount - 1);
                likeIcon.className = 'far fa-heart text-4xl';
                likeCount.className = 'text-3xl font-bold text-gray-800';
            }
            
            if (likeCount) {
                likeCount.textContent = currentLikeCount.toLocaleString();
            }
        }
        
        function showImagesTab() {
            trackEvent('click', { element: 'tab-switch', tab: 'images' });
            document.getElementById('imagesGrid').classList.remove('hidden');
            document.getElementById('videosGrid').classList.add('hidden');
            document.getElementById('imagesPagination').classList.remove('hidden');
            document.getElementById('videosPagination').classList.add('hidden');
            document.getElementById('imagesTabBtn').className = 'flex-1 px-8 py-3 text-center cursor-pointer transition-colors bg-blue-500 text-white';
            document.getElementById('videosTabBtn').className = 'flex-1 px-8 py-3 text-center cursor-pointer transition-colors bg-gray-600 text-white';
            renderImagesPage(currentImagePage);
        }
        
        function showVideosTab() {
            trackEvent('click', { element: 'tab-switch', tab: 'videos' });
            document.getElementById('videosGrid').classList.remove('hidden');
            document.getElementById('imagesGrid').classList.add('hidden');
            document.getElementById('videosPagination').classList.remove('hidden');
            document.getElementById('imagesPagination').classList.add('hidden');
            document.getElementById('videosTabBtn').className = 'flex-1 px-8 py-3 text-center cursor-pointer transition-colors bg-blue-500 text-white';
            document.getElementById('imagesTabBtn').className = 'flex-1 px-8 py-3 text-center cursor-pointer transition-colors bg-gray-600 text-white';
            renderVideosPage(currentVideoPage);
        }
        
        function renderImagesPage(page) {
            const imageUrls = ["https://images.unsplash.com/photo-1494790108755-2616c345834c?w=600&h=400&fit=crop","https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=600&h=400&fit=crop"];
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedImages = imageUrls.slice(startIndex, endIndex);
            
            const grid = document.getElementById('imagesGrid');
            const isMobile = window.innerWidth <= 768;
            
            grid.innerHTML = paginatedImages.map((url, index) => `
            <div class="image-item ${globalAuthState.isAuthenticated ? 'unlocked' : ''} bg-white border border-gray-200 rounded-xl overflow-hidden hover:bg-gray-50 transition-colors cursor-pointer relative">
                <div class="aspect-video relative">
                    <img src="${url}" alt="Foto #${startIndex + index + 1}" class="w-full h-full object-cover ${globalAuthState.isAuthenticated ? '' : 'blur-sm'}">
                    
                    <!-- Profile Overlay - Ajustado para mobile -->
                    <div class="absolute ${isMobile ? 'top-2 left-2' : 'top-4 left-4'} flex items-center space-x-2 bg-white bg-opacity-90 backdrop-blur-sm rounded-lg ${isMobile ? 'p-2' : 'p-3'} shadow-lg ${isMobile ? 'max-w-[200px]' : ''}">
                        <div class="${isMobile ? 'w-8 h-8' : 'w-12 h-12'} rounded-full overflow-hidden border-2 border-white shadow-sm flex-shrink-0">
                            <img src="https://images.unsplash.com/photo-1494790108755-2616c345834c?w=300&h=300&fit=crop&crop=face" alt="Profile" class="w-full h-full object-cover">
                        </div>
                        <div class="text-left min-w-0 flex-1">
                            <h4 class="${isMobile ? 'text-xs' : 'text-sm'} font-bold text-gray-900 leading-none truncate">Nia Cruz üñ§ Latina Cutie</h4>
                            <p class="${isMobile ? 'text-xs' : 'text-xs'} text-gray-600 mt-1 truncate">@niacruzxo</p>
                            ${!isMobile ? `
                            <div class="flex items-center mt-1">
                                <span class="w-2 h-2 bg-green-500 rounded-full mr-1"></span>
                                <span class="text-xs text-green-600 font-medium">Offline</span>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    ${!globalAuthState.isAuthenticated ? `
                    <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center lock-overlay">
                        <div class="text-center">
                            <i class="fas fa-lock text-white text-4xl mb-2"></i>
                            <p class="text-white font-semibold">Conte√∫do Exclusivo</p>
                            <p class="text-white text-sm">Clique aqui</p>
                            <button onclick="shareContent()" class="mt-3 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-full text-sm font-medium transition-colors flex items-center mx-auto">
                                <i class="fas fa-share-alt mr-2"></i>
                                Compartilhar
                            </button>
                        </div>
                    </div>
                    ` : ''}
                </div>
            </div>
            `).join('');
            
            updateContentAccess();
            updateImagesPagination(page, imageUrls.length);
        }
        
        function renderVideosPage(page) {
            const videoUrls = ["https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"];
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedVideos = videoUrls.slice(startIndex, endIndex);
            
            const grid = document.getElementById('videosGrid');
            const isMobile = window.innerWidth <= 768;
            
            // Fun√ß√£o para validar URL de v√≠deo
            function isValidVideoUrl(url) {
                try {
                    new URL(url);
                    return url.match(/.(mp4|webm|ogg|mov|avi)$/i) || url.includes('youtube.com') || url.includes('vimeo.com');
                } catch {
                    return false;
                }
            }
            
            grid.innerHTML = paginatedVideos.filter(url => isValidVideoUrl(url)).map((url, index) => `
            <div class="video-item ${globalAuthState.isAuthenticated ? 'unlocked' : ''} bg-white border border-gray-200 rounded-xl overflow-hidden hover:bg-gray-50 transition-colors cursor-pointer relative">
                <div class="aspect-video bg-gray-100 relative">
                    <video 
                        class="w-full h-full object-cover ${globalAuthState.isAuthenticated ? '' : 'blur-sm'}" 
                        preload="metadata"
                        controls="${globalAuthState.isAuthenticated}"
                        muted
                        poster=""
                        onError="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                        style="max-width: 100%; max-height: 100%;"
                    >
                        <source src="${url}" type="video/mp4">
                        <source src="${url}" type="video/webm">
                        <source src="${url}" type="video/ogg">
                        Seu navegador n√£o suporta v√≠deos.
                    </video>
                    <!-- Fallback para erro de v√≠deo -->
                    <div class="hidden absolute inset-0 bg-gray-200 flex items-center justify-center">
                        <div class="text-center text-gray-500">
                            <i class="fas fa-video text-3xl mb-2"></i>
                            <p class="text-sm">V√≠deo indispon√≠vel</p>
                        </div>
                    </div>
                    
                    <!-- Profile Overlay - Ajustado para mobile -->
                    <div class="absolute ${isMobile ? 'top-2 left-2' : 'top-4 left-4'} flex items-center space-x-2 bg-white bg-opacity-90 backdrop-blur-sm rounded-lg ${isMobile ? 'p-2' : 'p-3'} shadow-lg ${isMobile ? 'max-w-[200px]' : ''}">
                        <div class="${isMobile ? 'w-8 h-8' : 'w-12 h-12'} rounded-full overflow-hidden border-2 border-white shadow-sm flex-shrink-0">
                            <img src="https://images.unsplash.com/photo-1494790108755-2616c345834c?w=300&h=300&fit=crop&crop=face" alt="Profile" class="w-full h-full object-cover">
                        </div>
                        <div class="text-left min-w-0 flex-1">
                            <h4 class="${isMobile ? 'text-xs' : 'text-sm'} font-bold text-gray-900 leading-none truncate">Nia Cruz üñ§ Latina Cutie</h4>
                            <p class="${isMobile ? 'text-xs' : 'text-xs'} text-gray-600 mt-1 truncate">@niacruzxo</p>
                            ${!isMobile ? `
                            <div class="flex items-center mt-1">
                                <span class="w-2 h-2 bg-green-500 rounded-full mr-1"></span>
                                <span class="text-xs text-green-600 font-medium">Offline</span>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    ${!globalAuthState.isAuthenticated ? `
                    <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center lock-overlay">
                        <div class="text-center">
                            <i class="fas fa-lock text-white text-4xl mb-2"></i>
                            <p class="text-white font-semibold">Conte√∫do Exclusivo</p>
                            <p class="text-white text-sm">Clique aqui</p>
                            <button onclick="shareContent()" class="mt-3 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-full text-sm font-medium transition-colors flex items-center mx-auto">
                                <i class="fas fa-share-alt mr-2"></i>
                                Compartilhar
                            </button>
                        </div>
                    </div>
                    ` : ''}
                </div>
            </div>
            `).join('');
            
            updateContentAccess();
            updateVideosPagination(page, videoUrls.length);
        }
        
        function updateImagesPagination(currentPage, totalItems) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const pagination = document.getElementById('imagesPagination');
            
            if (totalPages <= 1) {
                pagination.style.display = 'none';
                return;
            }
            
            pagination.style.display = 'flex';
            pagination.innerHTML = `
                <button onclick="changeImagePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''} class="px-3 py-1 mx-1 bg-gray-200 text-gray-700 rounded disabled:opacity-50">
                    Anterior
                </button>
                <span class="px-3 py-1 mx-1 bg-blue-500 text-white rounded">
                    ${currentPage} de ${totalPages}
                </span>
                <button onclick="changeImagePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''} class="px-3 py-1 mx-1 bg-gray-200 text-gray-700 rounded disabled:opacity-50">
                    Pr√≥xima
                </button>
            `;
        }
        
        function updateVideosPagination(currentPage, totalItems) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const pagination = document.getElementById('videosPagination');
            
            if (totalPages <= 1) {
                pagination.style.display = 'none';
                return;
            }
            
            pagination.style.display = 'flex';
            pagination.innerHTML = `
                <button onclick="changeVideoPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''} class="px-3 py-1 mx-1 bg-gray-200 text-gray-700 rounded disabled:opacity-50">
                    Anterior
                </button>
                <span class="px-3 py-1 mx-1 bg-blue-500 text-white rounded">
                    ${currentPage} de ${totalPages}
                </span>
                <button onclick="changeVideoPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''} class="px-3 py-1 mx-1 bg-gray-200 text-gray-700 rounded disabled:opacity-50">
                    Pr√≥xima
                </button>
            `;
        }
        
        function changeImagePage(page) {
            const imageUrls = ["https://images.unsplash.com/photo-1494790108755-2616c345834c?w=600&h=400&fit=crop","https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=600&h=400&fit=crop"];
            const totalPages = Math.ceil(imageUrls.length / itemsPerPage);
            
            if (page < 1 || page > totalPages) return;
            
            currentImagePage = page;
            renderImagesPage(page);
        }
        
        function changeVideoPage(page) {
            const videoUrls = ["https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"];
            const totalPages = Math.ceil(videoUrls.length / itemsPerPage);
            
            if (page < 1 || page > totalPages) return;
            
            currentVideoPage = page;
            renderVideosPage(page);
        }
        
        // Responsividade - Rerender quando a tela mudar de tamanho
        window.addEventListener('resize', function() {
            if (document.getElementById('imagesGrid').classList.contains('hidden')) {
                renderVideosPage(currentVideoPage);
            } else {
                renderImagesPage(currentImagePage);
            }
        });
    
        
        // CSS para anima√ß√£o flutuante
        const floatingCss = `
        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        `;
        
        // Adicionar CSS ao head
        const style = document.createElement('style');
        style.textContent = floatingCss;
        document.head.appendChild(style);
        
        // Inicializar quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function() {
            updateChatStatus();
        });
    </script>
</body>
</html>